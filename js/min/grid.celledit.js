(function(h){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],h):"object"===typeof exports?h(require("jquery")):h(jQuery)})(function(h){var p=h.jgrid,B=function(){var a=h.makeArray(arguments);a.unshift("");a.unshift("");a.unshift(this.p);return p.feedback.apply(this,a)},E=function(a,b){return p.mergeCssClasses(p.getRes(p.guiStyles[this.p.guiStyle],"states."+a),b||"")},C=function(a,b){var f=this.grid.fbRows;return h((null!=f&&f[0].cells.length>
b?f[a.rowIndex]:a).cells[b])};p.extend({editCell:function(a,b,f){return this.each(function(){var c=this,g=h(c),e=c.p,l,d,k,t;l=c.rows;if(c.grid&&!0===e.cellEdit&&null!=l&&null!=l[a]&&(a=parseInt(a,10),b=parseInt(b,10),!isNaN(a)&&!isNaN(b))){var v=l[a],m=null!=v?v.id:null,r=h(v),q=parseInt(e.iCol,10),z=parseInt(e.iRow,10),w=h(l[z]),u=e.savedRow;if(null!=m){e.selrow=m;e.knv||g.jqGrid("GridNav");if(0<u.length){if(!0===f&&a===z&&b===q)return;g.jqGrid("saveCell",u[0].id,u[0].ic)}else setTimeout(function(){h("#"+
p.jqID(e.knv)).attr("tabindex","-1").focus()},1);t=e.colModel[b];l=t.name;if("subgrid"!==l&&"cb"!==l&&"rn"!==l){k=C.call(c,v,b);v=t.editable;h.isFunction(v)&&(v=v.call(c,{rowid:m,iCol:b,iRow:a,name:l,cm:t,mode:"cell"}));var n=E.call(c,"select","edit-cell"),y=E.call(c,"hover","selected-row");if(!0!==v||!0!==f||k.hasClass("not-editable-cell"))0<=q&&0<=z&&(C.call(c,w[0],q).removeClass(n),w.removeClass(y)),k.addClass(n),r.addClass(y),d=k.html().replace(/\&#160\;/ig,""),B.call(c,"onSelectCell",m,l,d,a,
b);else{0<=q&&0<=z&&(C.call(c,w[0],q).removeClass(n),w.removeClass(y));k.addClass(n);r.addClass(y);t.edittype||(t.edittype="text");r=t.edittype;try{d=h.unformat.call(c,k,{rowId:m,colModel:t},b)}catch(x){d="textarea"===r?k.text():k.html()}e.autoEncodeOnEdit&&(d=p.oldDecodePostedData(d));u.push({id:a,ic:b,name:l,v:d});if("&nbsp;"===d||"&#160;"===d||1===d.length&&160===d.charCodeAt(0))d="";h.isFunction(e.formatCell)&&(q=e.formatCell.call(c,m,l,d,a,b),void 0!==q&&(d=q));B.call(c,"beforeEditCell",m,l,
d,a,b);t=h.extend({},t.editoptions||{},{id:a+"_"+l,name:l,rowId:m,mode:"cell"});var A=p.createEl.call(c,r,t,d,!0,h.extend({},p.ajaxOptions,e.ajaxSelectOptions||{})),r=k;(q=!0===e.treeGrid&&l===e.ExpandColumn)&&(r=k.children("span.cell-wrapperleaf,span.cell-wrapper"));r.html("").append(A).attr("tabindex","0");q&&h(A).width(k.width()-k.children("div.tree-wrap").outerWidth());p.bindEv.call(c,A,t);setTimeout(function(){h(A).focus()},1);h("input, select, textarea",k).bind("keydown",function(f){27===f.keyCode&&
(0<h("input.hasDatepicker",k).length?h(".ui-datepicker").is(":hidden")?g.jqGrid("restoreCell",a,b):h("input.hasDatepicker",k).datepicker("hide"):g.jqGrid("restoreCell",a,b));if(13===f.keyCode&&!f.shiftKey)return g.jqGrid("saveCell",a,b),!1;if(9===f.keyCode){if(c.grid.hDiv.loading)return!1;f.shiftKey?g.jqGrid("prevCell",a,b):g.jqGrid("nextCell",a,b)}f.stopPropagation()});B.call(c,"afterEditCell",m,l,d,a,b);g.triggerHandler("jqGridAfterEditCell",[m,l,d,a,b])}e.iCol=b;e.iRow=a}}}})},saveCell:function(a,
b){return this.each(function(){var f=this,c=h(f),g=f.p,e=p.info_dialog,l=p.jqID;if(f.grid&&!0===g.cellEdit){var d=c.jqGrid("getGridRes","errors"),k=d.errcap,t=c.jqGrid("getGridRes","edit").bClose,v=g.savedRow,m=1<=v.length?0:null;if(null!==m){var r=f.rows[a],q=r.id,z=h(r),w=g.colModel[b],u=w.name,n,y=C.call(f,r,b);n=p.getEditedValue.call(f,y,w,!w.formatter);if(n!==v[m].v){m=c.triggerHandler("jqGridBeforeSaveCell",[q,u,n,a,b]);void 0!==m&&(n=m);h.isFunction(g.beforeSaveCell)&&(m=g.beforeSaveCell.call(f,
q,u,n,a,b),void 0!==m&&(n=m));var A=p.checkValues.call(f,n,b),r=w.formatoptions||{};if(!0===A[0]){m=c.triggerHandler("jqGridBeforeSubmitCell",[q,u,n,a,b])||{};h.isFunction(g.beforeSubmitCell)&&((m=g.beforeSubmitCell.call(f,q,u,n,a,b))||(m={}));0<h("input.hasDatepicker",y).length&&h("input.hasDatepicker",y).datepicker("hide");"date"===w.formatter&&!0!==r.sendFormatted&&(n=h.unformat.date.call(f,n,w));if("remote"===g.cellsubmit)if(g.cellurl){var x={};x[u]=n;var d=g.prmNames,w=d.oper,D=f.grid.hDiv;x[d.id]=
p.stripPref(g.idPrefix,q);x[w]=d.editoper;x=h.extend(m,x);g.autoEncodeOnEdit&&h.each(x,function(a,b){h.isFunction(b)||(x[a]=p.oldEncodePostedData(b))});c.jqGrid("progressBar",{method:"show",loadtype:g.loadui,htmlcontent:p.defaults.savetext||"Saving..."});D.loading=!0;h.ajax(h.extend({url:h.isFunction(g.cellurl)?g.cellurl.call(f,g.cellurl,a,b,q,n,u):g.cellurl,data:p.serializeFeedback.call(f,g.serializeCellData,"jqGridSerializeCellData",x),type:"POST",complete:function(m){c.jqGrid("progressBar",{method:"hide",
loadtype:g.loadui});D.loading=!1;if((300>m.status||304===m.status)&&(0!==m.status||4!==m.readyState)){var d=c.triggerHandler("jqGridAfterSubmitCell",[f,m,x.id,u,n,a,b])||[!0,""];!0===d[0]&&h.isFunction(g.afterSubmitCell)&&(d=g.afterSubmitCell.call(f,m,x.id,u,n,a,b));!0===d[0]?(c.jqGrid("setCell",q,b,n,!1,!1,!0),y.addClass("dirty-cell"),z.addClass("edited"),B.call(f,"afterSaveCell",q,u,n,a,b),v.splice(0,1)):(e.call(f,k,d[1],t),c.jqGrid("restoreCell",a,b))}},error:function(m,d,r){h("#lui_"+l(g.id)).hide();
D.loading=!1;c.triggerHandler("jqGridErrorCell",[m,d,r]);h.isFunction(g.errorCell)?g.errorCell.call(f,m,d,r):e.call(f,k,m.status+" : "+m.statusText+"<br/>"+d,t);c.jqGrid("restoreCell",a,b)}},p.ajaxOptions,g.ajaxCellOptions||{}))}else try{e.call(f,k,d.nourl,t),c.jqGrid("restoreCell",a,b)}catch(F){}"clientArray"===g.cellsubmit&&(c.jqGrid("setCell",q,b,n,!1,!1,!0),y.addClass("dirty-cell"),z.addClass("edited"),B.call(f,"afterSaveCell",q,u,n,a,b),v.splice(0,1))}else try{setTimeout(function(){e.call(f,
k,n+" "+A[1],t)},100),c.jqGrid("restoreCell",a,b)}catch(F){}}else c.jqGrid("restoreCell",a,b)}setTimeout(function(){h("#"+l(g.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(a,b){return this.each(function(){var f=this.p,c=this.rows[a],g=c.id,e,l;if(this.grid&&!0===f.cellEdit){var d=f.savedRow;e=C.call(this,c,b);if(1<=d.length){if(h.isFunction(h.fn.datepicker))try{h("input.hasDatepicker",e).datepicker("hide")}catch(k){}c=f.colModel[b];!0===f.treeGrid&&c.name===f.ExpandColumn?e.children("span.cell-wrapperleaf,span.cell-wrapper").empty():
e.empty();e.attr("tabindex","-1");e=d[0].v;l=c.formatoptions||{};"date"===c.formatter&&!0!==l.sendFormatted&&(e=h.unformat.date.call(this,e,c));h(this).jqGrid("setCell",g,b,e,!1,!1,!0);B.call(this,"afterRestoreCell",g,e,a,b);d.splice(0,1)}setTimeout(function(){h("#"+f.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(a,b){return this.each(function(){var f=h(this),c=this.p,g=!1,e,l,d,k=this.rows;if(this.grid&&!0===c.cellEdit&&null!=k&&null!=k[a]){for(e=b+1;e<c.colModel.length;e++)if(d=c.colModel[e],
l=d.editable,h.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:e,iRow:a,name:d.name,cm:d,mode:"cell"})),!0===l){g=e;break}!1!==g?f.jqGrid("editCell",a,g,!0):0<c.savedRow.length&&f.jqGrid("saveCell",a,b)}})},prevCell:function(a,b){return this.each(function(){var f=h(this),c=this.p,g=!1,e,l,d,k=this.rows;if(this.grid&&!0===c.cellEdit&&null!=k&&null!=k[a]){for(e=b-1;0<=e;e--)if(d=c.colModel[e],l=d.editable,h.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:e,iRow:a,name:d.name,cm:d,mode:"cell"})),
!0===l){g=e;break}!1!==g?f.jqGrid("editCell",a,g,!0):0<c.savedRow.length&&f.jqGrid("saveCell",a,b)}})},GridNav:function(){return this.each(function(){function a(a,b,c){a=f.rows[a];if("v"===c.substr(0,1)){var g=k.clientHeight,d=k.scrollTop,h=a.offsetTop+a.clientHeight,e=a.offsetTop;"vd"===c&&h>=g&&(k.scrollTop+=a.clientHeight);"vu"===c&&e<d&&(k.scrollTop-=a.clientHeight)}"h"===c&&(c=k.scrollLeft,b=a.cells[b],a=b.offsetLeft,b.offsetLeft+b.clientWidth>=k.clientWidth+parseInt(c,10)?k.scrollLeft+=b.clientWidth:
a<c&&(k.scrollLeft-=b.clientWidth))}function b(a,b){var c=0,d,f=g.colModel;if("lft"===b)for(c=a+1,d=a;0<=d;d--)if(!0!==f[d].hidden){c=d;break}if("rgt"===b)for(c=a-1,d=a;d<f.length;d++)if(!0!==f[d].hidden){c=d;break}return c}var f=this,c=h(f),g=f.p,e=f.grid,l,d;if(e&&!0===g.cellEdit){var k=e.bDiv;g.knv=g.id+"_kn";var t=h("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+g.knv+"'></div></div>");h(t).insertBefore(e.cDiv);h("#"+
g.knv).focus().keydown(function(h){var e=parseInt(g.iRow,10),k=parseInt(g.iCol,10);d=h.keyCode;"rtl"===g.direction&&(37===d?d=39:39===d&&(d=37));switch(d){case 38:0<e-1&&(a(e-1,k,"vu"),c.jqGrid("editCell",e-1,k,!1));break;case 40:e+1<=f.rows.length-1&&(a(e+1,k,"vd"),c.jqGrid("editCell",e+1,k,!1));break;case 37:0<=k-1&&(l=b(k-1,"lft"),a(e,l,"h"),c.jqGrid("editCell",e,l,!1));break;case 39:k+1<=g.colModel.length-1&&(l=b(k+1,"rgt"),a(e,l,"h"),c.jqGrid("editCell",e,l,!1));break;case 13:0<=k&&0<=e&&c.jqGrid("editCell",
e,k,!0);break;default:return!0}return!1})}})},getChangedCells:function(a){var b=[];a||(a="all");this.each(function(){var f=this,c=f.p,g=p.htmlDecode,e=f.rows;f.grid&&!0===c.cellEdit&&h(e).each(function(l){var d={};if(h(this).hasClass("edited")){var k=this;h(this.cells).each(function(b){var p=c.colModel[b],m=p.name,r=C.call(f,k,b);if("cb"!==m&&"subgrid"!==m&&"rn"!==m&&("dirty"!==a||r.hasClass("dirty-cell")))try{d[m]=h.unformat.call(f,r[0],{rowId:e[l].id,colModel:p},b)}catch(q){d[m]=g(r.html())}});
d.id=this.id;b.push(d)}})});return b}})});
/*
//# sourceMappingURL=grid.celledit.map
*/