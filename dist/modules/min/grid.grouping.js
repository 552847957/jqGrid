(function(d){"function"===typeof define&&define.amd?define(["jquery","./grid.base"],d):"object"===typeof exports?d(require("jquery")):d(jQuery)})(function(d){var C=d.jgrid,x=d.fn.jqGrid;C.extend({groupingSetup:function(){return this.each(function(){var b,n;n=this.p;var e=n.colModel,a=n.groupingView,c,k,f=function(){return""};if(null===a||"object"!==typeof a&&!d.isFunction(a))n.grouping=!1;else if(a.groupField.length){void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]);a.lastvalues=
[];a._locgr||(a.groups=[]);a.counters=[];for(b=0;b<a.groupField.length;b++)a.groupOrder[b]||(a.groupOrder[b]="asc"),a.groupText[b]||(a.groupText[b]="{0}"),"boolean"!==typeof a.groupColumnShow[b]&&(a.groupColumnShow[b]=!0),"boolean"!==typeof a.groupSummary[b]&&(a.groupSummary[b]=!1),a.groupSummaryPos[b]||(a.groupSummaryPos[b]="footer"),c=e[n.iColByName[a.groupField[b]]],!0===a.groupColumnShow[b]?(a.visibiltyOnNextGrouping[b]=!0,null!=c&&!0===c.hidden&&x.showCol.call(d(this),a.groupField[b])):(a.visibiltyOnNextGrouping[b]=
d("#"+C.jqID(n.id+"_"+a.groupField[b])).is(":visible"),null!=c&&!0!==c.hidden&&x.hideCol.call(d(this),a.groupField[b]));a.summary=[];a.hideFirstGroupCol&&(a.formatDisplayField[0]=function(a){return a});b=0;for(n=e.length;b<n;b++)c=e[b],a.hideFirstGroupCol&&!c.hidden&&a.groupField[0]===c.name&&(c.formatter=f),c.summaryType&&(k={nm:c.name,st:c.summaryType,v:"",sr:c.summaryRound,srt:c.summaryRoundType||"round"},c.summaryDivider&&(k.sd=c.summaryDivider,k.vd=""),a.summary.push(k))}else n.grouping=!1})},
groupingPrepare:function(b,n){this.each(function(){var e=this.p.groupingView,a=e.groups,c=e.counters,k=e.lastvalues,f=e.isInTheSameGroup,p=e.groupField.length,q,u,g,v,h=!1,w=x.groupingCalculations.handler;for(q=0;q<p;q++)if(u=e.groupField[q],g=e.displayField[q],v=b[u],g=null==g?null:b[g],null==g&&(g=v),void 0!==v){u={idx:q,dataIndex:u,value:v,displayValue:g,startRow:n,cnt:1,summary:[]};0===n?(a.push(u),k[q]=v,g={cnt:1,pos:a.length-1,summary:d.extend(!0,[],e.summary)},c[q]=g):(g={cnt:1,pos:a.length,
summary:d.extend(!0,[],e.summary)},"object"===typeof v||(d.isArray(f)&&d.isFunction(f[q])?f[q].call(this,k[q],v,q,e):k[q]===v)?h?(a.push(u),k[q]=v,c[q]=g):(g=c[q],g.cnt+=1,a[g.pos].cnt=g.cnt):(a.push(u),k[q]=v,h=!0,c[q]=g));v=a[g.pos];for(var B=void 0,r=void 0,y=void 0,B=0;B<g.summary.length;B++)r=g.summary[B],y=d.isArray(r.st)?r.st[u.idx]:r.st,d.isFunction(y)?r.v=y.call(this,r.v,r.nm,b,u):(r.v=w.call(d(this),y,r.v,r.nm,r.sr,r.srt,b),"avg"===y.toLowerCase()&&r.sd&&(r.vd=w.call(d(this),y,r.vd,r.sd,
r.sr,r.srt,b)));v.summary=g.summary}});return this},groupingToggle:function(b,n){this.each(function(){var e=this.p,a=e.groupingView,c=a.minusicon,k=a.plusicon,f=n?d(n).closest("tr.jqgroup"):d("#"+C.jqID(b)),p,q,u=!0,g=!1,v=[],h=function(a){var b,c=a.length;for(b=0;b<c;b++)v.push(a[b])},w=parseInt(f.data("jqgrouplevel"),10);e.frozenColumns&&0<f.length&&(q=f[0].rowIndex,f=d(this.rows[q]),f=f.add(this.grid.fbRows[q]));p=f.find(">td>span.tree-wrap");C.hasAllClasses(p,c)?(p.removeClass(c).addClass(k),
g=!0):p.removeClass(k).addClass(c);for(f=f.next();f.length;f=f.next())if(f.hasClass("jqfoot"))if(p=parseInt(f.data("jqfootlevel"),10),g){if(p=parseInt(f.data("jqfootlevel"),10),(!a.showSummaryOnHide&&p===w||p>w)&&h(f),p<w)break}else{if((p===w||a.showSummaryOnHide&&p===w+1)&&h(f),p<=w)break}else if(f.hasClass("jqgroup"))if(p=parseInt(f.data("jqgrouplevel"),10),g){if(p<=w)break;h(f)}else{if(p<=w)break;p===w+1&&(f.find(">td>span.tree-wrap").removeClass(c).addClass(k),h(f));u=!1}else(g||u)&&h(f);d(v).css("display",
g?"none":"");e.frozenColumns&&d(this).triggerHandler("jqGridResetFrozenHeights",[{header:{resizeDiv:!1,resizedRows:{iRowStart:-1,iRowEnd:-1}},resizeFooter:!1,body:{resizeDiv:!0,resizedRows:{iRowStart:q,iRowEnd:f.length?f[0].rowIndex-1:-1}}}]);this.fixScrollOffsetAndhBoxPadding();d(this).triggerHandler("jqGridGroupingClickGroup",[b,g]);d.isFunction(e.onClickGroup)&&e.onClickGroup.call(this,b,g)});return!1},groupingRender:function(b,n){function e(a,b,e,f,n){var g=y[a],m,q="",p,t,r,v=0,u,w,x,B=!0;if(0!==
b&&0!==y[a].idx)for(m=a;0<=m;m--)if(y[m].idx===y[a].idx-b){g=y[m];break}a=g.cnt;for(u=void 0===n?f:0;u<H;u++){b="&#160;";m=z[u];for(p=0;p<g.summary.length;p++)if(t=g.summary[p],w=d.isArray(t.st)?t.st[e.idx]:t.st,x=d.isArray(m.summaryTpl)?m.summaryTpl[e.idx]:m.summaryTpl||"{0}",t.nm===m.name){"string"===typeof w&&"avg"===w.toLowerCase()&&(t.sd&&t.vd?t.v/=t.vd:t.v&&0<a&&(t.v/=a));try{t.groupCount=g.cnt,t.groupIndex=g.dataIndex,t.groupValue=g.value,r=c.formatter("",t.v,u,t)}catch(G){r=t.v}b=C.format(x,
r);m.summaryFormat&&(b=m.summaryFormat.call(c,e,b,r,m));break}t=p=!1;void 0!==n&&B&&!m.hidden&&(b=n,B=!1,1<f&&(p=!0,v=f-1),t=m.align,m.align="rtl"===k.direction?"right":"left",h.iconColumnName=m.name);0<v&&!m.hidden&&"&#160;"===b?(t&&(m.align=t),v--):(q+="<td role='gridcell' "+c.formatCol(u,1,"")+(p?"colspan='"+f+"'":"")+">"+b+"</td>",t&&(m.align=t))}return q}var a="",c=this[0],k=c.p,f=0,p,q=[],u="",g,v,h=k.groupingView,w=d.makeArray(h.groupSummary),B=(h.groupCollapse?h.plusicon:h.minusicon)+" tree-wrap",
r=h.groupField.length,y=h.groups,z=k.colModel,H=z.length,G=k.page,I=x.getGuiStyles.call(c,"gridRow","jqgroup ui-row-"+k.direction),J=x.getGuiStyles.call(c,"gridRow","jqfoot ui-row-"+k.direction);d.each(z,function(a,b){var c;for(c=0;c<r;c++)if(h.groupField[c]===b.name){q[c]=a;break}});w.reverse();d.each(y,function(x,l){if(h._locgr&&!(l.startRow+l.cnt>(G-1)*n&&l.startRow<G*n))return!0;f++;v=k.id+"ghead_"+l.idx;g=v+"_"+x;u="<span style='cursor:pointer;margin-"+("rtl"===k.direction?"right:":"left:")+
12*l.idx+"px;' class='"+h.commonIconClass+" "+B+"' onclick=\"jQuery('#"+C.jqID(k.id).replace("\\","\\\\")+"').jqGrid('groupingToggle','"+g+"', this);return false;\"></span>";try{d.isArray(h.formatDisplayField)&&d.isFunction(h.formatDisplayField[l.idx])?(l.displayValue=h.formatDisplayField[l.idx].call(c,l.displayValue,l.value,z[q[l.idx]],l.idx,h),p=l.displayValue):p=c.formatter(g,l.displayValue,q[l.idx],l.value)}catch(K){p=l.displayValue}a+="<tr id='"+g+"' data-jqgrouplevel='"+l.idx+"' "+(h.groupCollapse&&
0<l.idx?"style='display:none;' ":"")+"role='row' class='"+I+" "+v+"'>";var A=d.isFunction(h.groupText[l.idx])?h.groupText[l.idx].call(c,p,l.cnt,l.summary):C.template(h.groupText[l.idx],p,l.cnt,l.summary),E=1,F,D,m;m=0;D=r-1===l.idx;"string"!==typeof A&&"number"!==typeof A&&(A=p);"header"===h.groupSummaryPos[l.idx]?(E=1,"cb"!==z[0].name&&"cb"!==z[1].name||E++,"subgrid"!==z[0].name&&"subgrid"!==z[1].name||E++,a+=e(x,0,l,E,u+"<span class='cell-wrapper'>"+A+"</span>")):a+="<td role='gridcell' style='padding-left:"+
12*l.idx+"px;' colspan='"+H+"'>"+u+A+"</td>";a+="</tr>";if(D){A=y[x+1];D=l.startRow;E=void 0!==A?A.startRow:y[x].startRow+y[x].cnt;h._locgr&&(m=(G-1)*n,m>l.startRow&&(D=m));for(;D<E&&b[D-m];D++)a+=b[D-m].join("");if("header"!==h.groupSummaryPos[l.idx]){if(void 0!==A){for(F=0;F<h.groupField.length&&A.dataIndex!==h.groupField[F];F++);f=h.groupField.length-F}for(m=0;m<f;m++)w[m]&&(a+="<tr data-jqfootlevel='"+(l.idx-m)+(h.groupCollapse&&(0<l.idx-m||!h.showSummaryOnHide)?"' style='display:none;'":"'")+
" role='row' class='"+J+"'>",a+=e(x,m,y[l.idx-m],0),a+="</tr>");f=F}}});this.unbind("jqGridShowHideCol.groupingRender").bind("jqGridShowHideCol.groupingRender",function(){var a=k.iColByName[h.iconColumnName],b,e,f;if(0<=d.inArray("header",h.groupSummaryPos)){for(b=0;b<z.length;b++)if(!z[b].hidden){f=b;break}if(void 0!==f&&a!==f){for(b=0;b<c.rows.length;b++)e=c.rows[b],d(e).hasClass("jqgroup")&&(d(e.cells[f]).html(e.cells[a].innerHTML),d(e.cells[a]).html("&nbsp;"));h.iconColumnName=z[f].name}}});return a},
groupingGroupBy:function(b,n){return this.each(function(){var e=this.p,a=e.groupingView,c,k;"string"===typeof b&&(b=[b]);e.grouping=!0;a._locgr=!1;void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]);for(c=0;c<a.groupField.length;c++)k=e.colModel[e.iColByName[a.groupField[c]]],!a.groupColumnShow[c]&&a.visibiltyOnNextGrouping[c]&&null!=k&&!0===k.hidden&&x.showCol.call(d(this),a.groupField[c]);for(c=0;c<b.length;c++)a.visibiltyOnNextGrouping[c]=d(e.idSel+"_"+C.jqID(b[c])).is(":visible");
e.groupingView=d.extend(e.groupingView,n||{});a.groupField=b;d(this).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){var n=this.p,e=this.tBodies[0],a=n.groupingView;void 0===b&&(b=!0);n.grouping=!1;if(!0===b){for(n=0;n<a.groupField.length;n++)!a.groupColumnShow[n]&&a.visibiltyOnNextGrouping[n]&&x.showCol.call(d(this),a.groupField);d("tr.jqgroup, tr.jqfoot",e).remove();d("tr.jqgrow",e).filter(":hidden").show()}else d(this).trigger("reloadGrid")})},groupingCalculations:{handler:function(b,
d,e,a,c,k){var f={sum:function(){return parseFloat(d||0)+parseFloat(k[e]||0)},min:function(){return""===d?parseFloat(k[e]||0):Math.min(parseFloat(d),parseFloat(k[e]||0))},max:function(){return""===d?parseFloat(k[e]||0):Math.max(parseFloat(d),parseFloat(k[e]||0))},count:function(){""===d&&(d=0);return k.hasOwnProperty(e)?d+1:0},avg:function(){return f.sum()}};if(!f[b])throw"jqGrid Grouping No such method: "+b;b=f[b]();null!=a&&("fixed"===c?b=b.toFixed(a):(a=Math.pow(10,a),b=Math.round(b*a)/a));return b}}})});
//# sourceMappingURL=grid.grouping.map
