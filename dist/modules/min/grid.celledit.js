(function(k){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],k):"object"===typeof module&&module.exports?module.exports=function(m,z){m||(m=window);void 0===z&&(z="undefined"!==typeof window?require("jquery"):require("jquery")(m));require("./grid.base");require("./jquery.fmatter");require("./grid.common");k(z);return z}:k(jQuery)})(function(k){var m=k.jgrid,z=function(){var a=k.makeArray(arguments);a.unshift("");a.unshift("");a.unshift(this.p);
return m.feedback.apply(this,a)},D=function(a,b){var c=this.grid.fbRows;return k((null!=c&&c[0].cells.length>b?c[a.rowIndex]:a).cells[b])};m.extend({editCell:function(a,b,c){return this.each(function(){var d=this,g=k(d),e=d.p,l,h,f,n;l=d.rows;if(d.grid&&!0===e.cellEdit&&null!=l&&null!=l[a]&&(a=parseInt(a,10),b=parseInt(b,10),!isNaN(a)&&!isNaN(b))){var w=l[a],p=null!=w?w.id:null,t=k(w),q=parseInt(e.iCol,10),u=parseInt(e.iRow,10),C=k(l[u]),x=e.savedRow;if(null!=p){e.selrow=p;e.knv||g.jqGrid("GridNav");
if(0<x.length){if(!0===c&&a===u&&b===q)return;g.jqGrid("saveCell",x[0].id,x[0].ic)}else setTimeout(function(){k("#"+m.jqID(e.knv)).attr("tabindex","-1").focus()},1);n=e.colModel[b];l=n.name;if("subgrid"!==l&&"cb"!==l&&"rn"!==l){f=D.call(d,w,b);w=n.editable;k.isFunction(w)&&(w=w.call(d,{rowid:p,iCol:b,iRow:a,cmName:l,cm:n,mode:"cell"}));var v=g.jqGrid("getGuiStyles","states.select","edit-cell"),A=g.jqGrid("getGuiStyles","states.hover","selected-row");if(!0!==w||!0!==c||f.hasClass("not-editable-cell"))0<=
q&&0<=u&&(D.call(d,C[0],q).removeClass(v),C.removeClass(A)),f.addClass(v),t.addClass(A),h=f.html().replace(/&#160;/ig,""),z.call(d,"onSelectCell",p,l,h,a,b);else{0<=q&&0<=u&&(D.call(d,C[0],q).removeClass(v),C.removeClass(A));f.addClass(v);t.addClass(A);n.edittype||(n.edittype="text");t=n.edittype;try{h=k.unformat.call(d,f,{rowId:p,colModel:n},b)}catch(F){h="textarea"===t?f.text():f.html()}e.autoEncodeOnEdit&&(h=m.oldDecodePostedData(h));x.push({id:a,ic:b,name:l,v:h});if("&nbsp;"===h||"&#160;"===h||
1===h.length&&160===h.charCodeAt(0))h="";k.isFunction(e.formatCell)&&(q=e.formatCell.call(d,p,l,h,a,b),void 0!==q&&(h=q));z.call(d,"beforeEditCell",p,l,h,a,b);n=k.extend({},n.editoptions||{},{id:a+"_"+l,name:l,rowId:p,mode:"cell",cm:n,iCol:b});var y=m.createEl.call(d,t,n,h,!0,k.extend({},m.ajaxOptions,e.ajaxSelectOptions||{})),t=f;(q=!0===e.treeGrid&&l===e.ExpandColumn)&&(t=f.children("span.cell-wrapperleaf,span.cell-wrapper"));t.html("").append(y).attr("tabindex","0");q&&k(y).width(f.width()-f.children("div.tree-wrap").outerWidth());
m.bindEv.call(d,y,n);setTimeout(function(){k(y).focus()},1);k("input, select, textarea",f).on("keydown",function(c){27===c.keyCode&&(0<k("input.hasDatepicker",f).length?k(".ui-datepicker").is(":hidden")?g.jqGrid("restoreCell",a,b):k("input.hasDatepicker",f).datepicker("hide"):g.jqGrid("restoreCell",a,b));if(13===c.keyCode&&!c.shiftKey)return g.jqGrid("saveCell",a,b),!1;if(9===c.keyCode){if(d.grid.hDiv.loading)return!1;c.shiftKey?g.jqGrid("prevCell",a,b):g.jqGrid("nextCell",a,b)}c.stopPropagation()});
z.call(d,"afterEditCell",p,l,h,a,b)}e.iCol=b;e.iRow=a}}}})},saveCell:function(a,b){return this.each(function(){var c=this,d=k(c),g=c.p,e=c.grid,l=m.info_dialog,h=m.jqID;if(e&&!0===g.cellEdit){var f=d.jqGrid("getGridRes","errors"),n=f.errcap,w=d.jqGrid("getGridRes","edit").bClose,p=g.savedRow,t=1<=p.length?0:null;if(null!==t){var q=c.rows[a],u=q.id,C=k(q),x=g.colModel[b],v=x.name,A,y=D.call(c,q,b),F={},r=m.getEditedValue.call(c,y,x,F);if(r!==p[t].v){A=d.triggerHandler("jqGridBeforeSaveCell",[u,v,r,
a,b]);void 0!==A&&(r=A);k.isFunction(g.beforeSaveCell)&&(A=g.beforeSaveCell.call(c,u,v,r,a,b),void 0!==A&&(r=A));var E=m.checkValues.call(c,r,b,void 0,void 0,{oldValue:p[t].v,newValue:r,cmName:v,rowid:u,iCol:b,iRow:a,cm:x,tr:q,td:y,mode:"cell"}),q=x.formatoptions||{};if(null==E||!0===E||!0===E[0]){t=d.triggerHandler("jqGridBeforeSubmitCell",[u,v,r,a,b])||{};k.isFunction(g.beforeSubmitCell)&&((t=g.beforeSubmitCell.call(c,u,v,r,a,b))||(t={}));0<k("input.hasDatepicker",y).length&&k("input.hasDatepicker",
y).datepicker("hide");"date"===x.formatter&&!0!==q.sendFormatted&&(r=k.unformat.date.call(c,r,x));if("remote"===g.cellsubmit)if(g.cellurl){var B={};B[v]=r;f=g.prmNames;q=f.oper;B[f.id]=m.stripPref(g.idPrefix,u);B[q]=f.editoper;B=k.extend(t,B);g.autoEncodeOnEdit&&k.each(B,function(a,c){k.isFunction(c)||(B[a]=m.oldEncodePostedData(c))});d.jqGrid("progressBar",{method:"show",loadtype:g.loadui,htmlcontent:d.jqGrid("getGridRes","defaults.savetext")||"Saving..."});e.hDiv.loading=!0;k.ajax(k.extend({url:k.isFunction(g.cellurl)?
g.cellurl.call(c,g.cellurl,a,b,u,r,v):g.cellurl,data:m.serializeFeedback.call(c,g.serializeCellData,"jqGridSerializeCellData",B),type:"POST",complete:function(f){e.endReq.call(c);if((300>f.status||304===f.status)&&(0!==f.status||4!==f.readyState)){var h=d.triggerHandler("jqGridAfterSubmitCell",[c,f,B.id,v,r,a,b])||[!0,""];if(!0===h||!0===h[0]&&k.isFunction(g.afterSubmitCell))h=g.afterSubmitCell.call(c,f,B.id,v,r,a,b);null==h||!0===h||!0===h[0]?(d.jqGrid("setCell",u,b,r,!1,!1,!0),y.addClass("dirty-cell"),
C.addClass("edited"),z.call(c,"afterSaveCell",u,v,r,a,b),p.splice(0,1)):(l.call(c,n,h[1],w),d.jqGrid("restoreCell",a,b))}},error:function(h,f,e){d.triggerHandler("jqGridErrorCell",[h,f,e]);k.isFunction(g.errorCell)?g.errorCell.call(c,h,f,e):l.call(c,n,h.status+" : "+h.statusText+"<br/>"+f,w);d.jqGrid("restoreCell",a,b)}},m.ajaxOptions,g.ajaxCellOptions||{}))}else try{l.call(c,n,f.nourl,w),d.jqGrid("restoreCell",a,b)}catch(G){}"clientArray"===g.cellsubmit&&(d.jqGrid("setCell",u,b,"select"===x.edittype&&
"select"!==x.formatter?F.text:r,!1,!1,!0),y.addClass("dirty-cell"),C.addClass("edited"),z.call(c,"afterSaveCell",u,v,r,a,b),p.splice(0,1))}else try{setTimeout(function(){var a=m.getRelativeRect.call(c,y);l.call(c,n,r+" "+E[1],w,{top:a.top,left:a.left+k(c).closest(".ui-jqgrid").offset().left})},50),d.jqGrid("restoreCell",a,b)}catch(G){}}else d.jqGrid("restoreCell",a,b)}setTimeout(function(){k("#"+h(g.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(a,b){return this.each(function(){var c=
this.p,d=this.rows[a],g=d.id,e,l;if(this.grid&&!0===c.cellEdit){var h=c.savedRow;e=D.call(this,d,b);if(1<=h.length){if(k.isFunction(k.fn.datepicker))try{k("input.hasDatepicker",e).datepicker("hide")}catch(f){}d=c.colModel[b];!0===c.treeGrid&&d.name===c.ExpandColumn?e.children("span.cell-wrapperleaf,span.cell-wrapper").empty():e.empty();e.attr("tabindex","-1");e=h[0].v;l=d.formatoptions||{};"date"===d.formatter&&!0!==l.sendFormatted&&(e=k.unformat.date.call(this,e,d));k(this).jqGrid("setCell",g,b,
e,!1,!1,!0);z.call(this,"afterRestoreCell",g,e,a,b);h.splice(0,1)}setTimeout(function(){k("#"+c.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(a,b){return this.each(function(){var c=k(this),d=this.p,g=!1,e,l,h,f=this.rows;if(this.grid&&!0===d.cellEdit&&null!=f&&null!=f[a]){for(e=b+1;e<d.colModel.length;e++)if(h=d.colModel[e],l=h.editable,k.isFunction(l)&&(l=l.call(this,{rowid:f[a].id,iCol:e,iRow:a,cmName:h.name,cm:h,mode:"cell"})),!0===l){g=e;break}!1!==g?c.jqGrid("editCell",a,g,!0):
0<d.savedRow.length&&c.jqGrid("saveCell",a,b)}})},prevCell:function(a,b){return this.each(function(){var c=k(this),d=this.p,g=!1,e,l,h,f=this.rows;if(this.grid&&!0===d.cellEdit&&null!=f&&null!=f[a]){for(e=b-1;0<=e;e--)if(h=d.colModel[e],l=h.editable,k.isFunction(l)&&(l=l.call(this,{rowid:f[a].id,iCol:e,iRow:a,cmName:h.name,cm:h,mode:"cell"})),!0===l){g=e;break}!1!==g?c.jqGrid("editCell",a,g,!0):0<d.savedRow.length&&c.jqGrid("saveCell",a,b)}})},GridNav:function(){return this.each(function(){function a(a,
b,g){a=c.rows[a];if("v"===g.substr(0,1)){var d=f.clientHeight,h=f.scrollTop,k=a.offsetTop+a.clientHeight,e=a.offsetTop;"vd"===g&&k>=d&&(f.scrollTop+=a.clientHeight);"vu"===g&&e<h&&(f.scrollTop-=a.clientHeight)}"h"===g&&(g=f.scrollLeft,b=a.cells[b],a=b.offsetLeft,b.offsetLeft+b.clientWidth>=f.clientWidth+parseInt(g,10)?f.scrollLeft+=b.clientWidth:a<g&&(f.scrollLeft-=b.clientWidth))}function b(a,b){var c=0,d,h=g.colModel;if("lft"===b)for(c=a+1,d=a;0<=d;d--)if(!0!==h[d].hidden){c=d;break}if("rgt"===
b)for(c=a-1,d=a;d<h.length;d++)if(!0!==h[d].hidden){c=d;break}return c}var c=this,d=k(c),g=c.p,e=c.grid,l,h;if(e&&!0===g.cellEdit){var f=e.bDiv;g.knv=g.id+"_kn";var n=k("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+g.knv+"'></div></div>");k(n).insertBefore(e.cDiv);k("#"+g.knv).focus().keydown(function(k){var e=parseInt(g.iRow,10),f=parseInt(g.iCol,10);h=k.keyCode;"rtl"===g.direction&&(37===h?h=39:39===h&&(h=37));switch(h){case 38:0<
e-1&&(a(e-1,f,"vu"),d.jqGrid("editCell",e-1,f,!1));break;case 40:e+1<=c.rows.length-1&&(a(e+1,f,"vd"),d.jqGrid("editCell",e+1,f,!1));break;case 37:0<=f-1&&(l=b(f-1,"lft"),a(e,l,"h"),d.jqGrid("editCell",e,l,!1));break;case 39:f+1<=g.colModel.length-1&&(l=b(f+1,"rgt"),a(e,l,"h"),d.jqGrid("editCell",e,l,!1));break;case 13:0<=f&&0<=e&&d.jqGrid("editCell",e,f,!0);break;default:return!0}return!1})}})},getChangedCells:function(a){var b=[];a||(a="all");this.each(function(){var c=this,d=c.p,g=m.htmlDecode,
e=c.rows;c.grid&&!0===d.cellEdit&&k(e).each(function(l){var h={};if(k(this).hasClass("edited")){var f=this;k(this.cells).each(function(b){var m=d.colModel[b],p=m.name,n=D.call(c,f,b);if("cb"!==p&&"subgrid"!==p&&"rn"!==p&&("dirty"!==a||n.hasClass("dirty-cell")))try{h[p]=k.unformat.call(c,n[0],{rowId:e[l].id,colModel:m},b)}catch(q){h[p]=g(n.html())}});h.id=this.id;b.push(h)}})});return b}})});
//# sourceMappingURL=grid.celledit.map
